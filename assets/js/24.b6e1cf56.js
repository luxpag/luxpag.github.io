(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{226:function(t,a,e){"use strict";e.r(a);var n=e(0),r=Object(n.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"直连接口下单并支付接入"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#直连接口下单并支付接入"}},[t._v("#")]),t._v(" 直连接口下单并支付接入")]),t._v(" "),e("h2",{attrs:{id:"一、渠道：pse、efecty（旧）"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、渠道：pse、efecty（旧）"}},[t._v("#")]),t._v(" 一、渠道：PSE、Efecty（旧）")]),t._v(" "),e("p",[t._v("新：PSE、Efecty 支付成功后通过pay_url跳转到payty付款(2023年3月27日启用)。")]),t._v(" "),e("p",[t._v("旧：PSE、Efecty 支付成功后需跳转到payty付款(已对接旧版，不支持新版)，详细流程如下：")]),t._v(" "),e("h4",{attrs:{id:"_1、支付返回样例（成功）："}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、支付返回样例（成功）："}},[t._v("#")]),t._v(" 1、支付返回样例（成功）：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('新\n{\n    "code":"10000",\n    "msg":"Success",\n    "out_trade_no":"out_trade_no_1285925731034600",\n    "trade_no":"LP20230310035011408-YNdRcq",\n    "trade_status":"PROCESSING",\n    "pay_url":"https://secure.payty.com/t/8x8pk8gk"\n}\n')])])]),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('旧：不支持\n{\n    "code":"10000",\n    "msg":"Success",\n    "trade_no":"2022021402120600004",\n    "out_trade_no":"LP20220214021316563-5d0Wg6",\n    "web_url":"",\n    "pay_url":"https://secure.payty.com/vads-payment/",\n    "trade_status":"PROCESSING",\n    "form_date":{\n        "vads_payment_cards":"VISA;PSE",\n        "signature":"V64LLsvVZR+7UoKGxEKu0alqTvAVmh81+5vASLLECl0=",\n        "vads_trans_date":"20220214021206",\n        "vads_ctx_mode":"TEST",\n        "vads_action_mode":"INTERACTIVE",\n        "vads_page_action":"PAYMENT",\n        "vads_order_description":"luxpag test",\n        "vads_order_id":"2022021402120600004",\n        "vads_currency":"170",\n        "vads_version":"V2",\n        "vads_trans_id":"07hscj",\n        "vads_amount":100000,\n        "vads_payment_config":"SINGLE",\n        "vads_site_id":"10454805"\n    }\n}\n')])])]),e("h4",{attrs:{id:"_2、支付成功跳转（不支持）："}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、支付成功跳转（不支持）："}},[t._v("#")]),t._v(" 2、支付成功跳转（不支持）：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('旧：不支持\n<input type="button" id="button1" onclick="pay()" value="Test" />\n\n<script type="text/javascript">\n    function pay() {\n        var pay_url = "https://secure.payty.com/vads-payment/";\n        var form_date = {\n            "vads_payment_cards": "VISA;PSE",\n            "signature": "V64LLsvVZR+7UoKGxEKu0alqTvAVmh81+5vASLLECl0=",\n            "vads_trans_date": "20220214021206",\n            "vads_ctx_mode": "TEST",\n            "vads_action_mode": "INTERACTIVE",\n            "vads_page_action": "PAYMENT",\n            "vads_order_description": "luxpag test",\n            "vads_order_id": "2022021402120600004",\n            "vads_currency": "170",\n            "vads_version": "V2",\n            "vads_trans_id": "07hscj",\n            "vads_amount": 100000,\n            "vads_payment_config": "SINGLE",\n            "vads_site_id": "10454805"\n        }\n        \n        location.href = pay_url + "?" + Object.keys(form_date)?.map((k) => `${encodeURIComponent(k)}=${encodeURIComponent(form_date[k])}`).join("&");\n    }\n<\/script>  \n')])])]),e("h2",{attrs:{id:"二、渠道：wallet-paypal"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、渠道：wallet-paypal"}},[t._v("#")]),t._v(" 二、渠道：Wallet - Paypal")]),t._v(" "),e("p",[t._v("Wallet Paypal 下单前需向luxpag获取token，然后向Paypal获取nonce，详细流程如下：")]),t._v(" "),e("h3",{attrs:{id:"_1、获取-luxpag-wallet-paypal-token："}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、获取-luxpag-wallet-paypal-token："}},[t._v("#")]),t._v(" 1、获取 Luxpag Wallet Paypal Token：")]),t._v(" "),e("h4",{attrs:{id:"请求接口root地址"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#请求接口root地址"}},[t._v("#")]),t._v(" 请求接口ROOT地址")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("  测试环境 : https://dev-gateway.luxpag.com\n  正式环境 : https://gateway.luxpag.com\n")])])]),e("h3",{attrs:{id:"接口"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#接口"}},[t._v("#")]),t._v(" 接口")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("  /trade/get-paypal-client-token\n")])])]),e("h4",{attrs:{id:"request-header"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#request-header"}},[t._v("#")]),t._v(" Request Header")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("参数名")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("必须")]),t._v(" "),e("th",[t._v("描述")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Content-Type")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("推荐")]),t._v(" "),e("td",[t._v("application/json")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Authorization")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("yes")]),t._v(" "),e("td",[e("a",{attrs:{href:"../faq"}},[t._v("Basic Base64(app_id:secret_key)")])])])])]),t._v(" "),e("h4",{attrs:{id:"请求参数（json格式）"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#请求参数（json格式）"}},[t._v("#")]),t._v(" 请求参数（JSON格式）")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("参数名")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("类型")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("必须")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("最大长度/默认值")]),t._v(" "),e("th",[t._v("描述")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("app_id")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("string")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("yes")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("32")]),t._v(" "),e("td",[t._v("商户后台创建并获得")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("timestamp")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("string")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("yes")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("19")]),t._v(" "),e("td",[t._v("yyyy-MM-dd HH:mm:ss")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("region")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("string")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("no")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}}),t._v(" "),e("td",[e("a",{attrs:{href:"region-list"}},[t._v("区域编码")]),t._v("，当 app 为 Global 时，该字段必须")])])])]),t._v(" "),e("h4",{attrs:{id:"请求样例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#请求样例"}},[t._v("#")]),t._v(" 请求样例")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("curl --location --request POST 'https://gateway.luxpag.com/trade/get-paypal-client-token' \\\n--header 'Authorization: Basic Base64(appid:secret_key)' \\\n--header 'Content-Type: application/json' \\\n--data-raw '{\n    \"app_id\": \"app_id\",\n    \"timestamp\": \"{{datetime}}\",\n}'\n")])])]),e("h4",{attrs:{id:"响应（json格式）"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#响应（json格式）"}},[t._v("#")]),t._v(" 响应（JSON格式）")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("参数名")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("类型")]),t._v(" "),e("th",[t._v("描述")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("code")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("string")]),t._v(" "),e("td",[t._v("返回码")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("msg")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("string")]),t._v(" "),e("td",[t._v("返回消息")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("token")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("string")]),t._v(" "),e("td",[t._v("token")])])])]),t._v(" "),e("h4",{attrs:{id:"返回样例（成功）"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#返回样例（成功）"}},[t._v("#")]),t._v(" 返回样例（成功）")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('{\n    "code": "10000",\n    "msg": "Success",\n    "token": "{token}",\n}\n')])])]),e("h3",{attrs:{id:"_2、获取-paypal-nonce："}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、获取-paypal-nonce："}},[t._v("#")]),t._v(" 2、获取 Paypal nonce：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("var myDeviceData;\n// token:Luxpag token\nfunction payForward(token) {\n    braintree.client.create({\n        authorization:  token // Token you got from Luxpag server\n    }).then(function (clientInstance) {\n        return braintree.dataCollector.create({\n            client: clientInstance,\n        });\n    }).then(function (dataCollectorInstance) {\n        // At this point, you should access the dataCollectorInstance.deviceData value and provide it\n        // to your server, e.g. by injecting it into your form as a hidden input\n        myDeviceData = dataCollectorInstance.deviceData;\n        // Initialize your PayPal Checkout component here\n        return braintree.paypalCheckout.create(/* ... */);\n    });\n    // Create a client.\n    braintree.client.create({\n        authorization: token//Token you got from Luxpag server\n    }).then(function (clientInstance) {\n        // Create a PayPal Checkout component.\n        return braintree.paypalCheckout.create({\n            client: clientInstance\n        });\n    }).then(function (paypalCheckoutInstance) {\n        return paypalCheckoutInstance.loadPayPalSDK({\n            vault: true\n        });\n    }).then(function (paypalCheckoutInstance) {\n        return paypal.Buttons({\n            fundingSource: paypal.FUNDING.PAYPAL,\n            createBillingAgreement: function () {\n                return paypalCheckoutInstance.createPayment({\n                    flow: 'vault', // Required\n                });\n            },\n            style: {\n                shape: \"rect\",\n                height: 52,\n            },\n            onApprove: function (data, actions) {\n                return paypalCheckoutInstance.tokenizePayment(data).then(function (payload) {\n                    // Submit `payload.nonce` to your server\n                    // Submit Luxpag pay Interface and token = payload.nonce\n                });\n            },\n            onCancel: function (data) {\n                console.log('PayPal payment canceled', JSON.stringify(data, 0, 2));\n            },\n            onError: function (err) {\n                console.error('PayPal error', err);\n            }\n        }).render('#paypal-button');\n    }).then(function () {\n        // The PayPal button will be rendered in an html element with the ID\n        // `paypal-button`. This function will be called when the PayPal button\n        // is set up and ready to be used\n    }).catch(function (err) {\n        // Handle component creation error\n    });\n}\n")])])]),e("h3",{attrs:{id:"_3、直连下单并支付："}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、直连下单并支付："}},[t._v("#")]),t._v(" 3、"),e("a",{attrs:{href:"/api-direct"}},[t._v("直连下单并支付")]),t._v("：")]),t._v(" "),e("p",[t._v("调用直连支付接口下单并支付。")]),t._v(" "),e("h3",{attrs:{id:"_4、申请luxpag钱包测试账号。"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4、申请luxpag钱包测试账号。"}},[t._v("#")]),t._v(" 4、申请Luxpag钱包测试账号。")]),t._v(" "),e("p",[t._v("测试用户账号。")]),t._v(" "),e("h3",{attrs:{id:"_5、样例。"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5、样例。"}},[t._v("#")]),t._v(" 5、样例。")]),t._v(" "),e("p",[t._v("仅供参考。建议把 Luxpag 接口请求写在服务端，获取 Paypal nonce 写在客户端。")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('<script src="https://res.luxpag.com/lib/js/jquery-1.10.2.min.js"><\/script>\n<script src="https://js.braintreegateway.com/web/3.85.2/js/client.min.js"><\/script>\n<script src="https://js.braintreegateway.com/web/3.85.2/js/paypal-checkout.min.js"><\/script>\n<script src="https://js.braintreegateway.com/web/3.79.0/js/data-collector.min.js"><\/script>\n\n<div id="paypal-button"> </div>\n\n<script type="text/javascript">\n    $(document).ready(function () {\n    var param= \'{"app_id":"???????","timestamp":"2022-01-20 14:55:10"}\';\n    $.ajax({\n        type: "POST",\n        url: "https://dev-gateway.luxpag.com/trade/get-paypal-client-token",\n        headers: {\'Authorization\': \'Basic ???????\'},\n        cache: false,\n        dataType: "json",\n        contentType: "application/json",\n        data: param,\n        success: function (d) {\n            if (d.code == "10000" && d.token != null) {\n                payForward(d.token);\n            }\n        }\n    });\n});\n\nvar myDeviceData;\n// token:Luxpag token\nfunction payForward(token) {\n    braintree.client.create({\n        authorization:  token\n    }).then(function (clientInstance) {\n        return braintree.dataCollector.create({\n            client: clientInstance,\n        });\n    }).then(function (dataCollectorInstance) {\n        myDeviceData = dataCollectorInstance.deviceData;\n        return braintree.paypalCheckout.create(/* ... */);\n    });\n    braintree.client.create({\n        authorization: token\n    }).then(function (clientInstance) {\n        return braintree.paypalCheckout.create({\n            client: clientInstance\n        });\n    }).then(function (paypalCheckoutInstance) {\n        return paypalCheckoutInstance.loadPayPalSDK({\n            vault: true\n        });\n    }).then(function (paypalCheckoutInstance) {\n        return paypal.Buttons({\n            fundingSource: paypal.FUNDING.PAYPAL,\n            createBillingAgreement: function () {\n                return paypalCheckoutInstance.createPayment({\n                    flow: \'vault\', // Required\n                });\n            },\n            style: {\n                shape: "rect",\n                height: 52,\n            },\n            onApprove: function (data, actions) {\n                return paypalCheckoutInstance.tokenizePayment(data).then(function (payload) {\n                    // Submit `payload.nonce` to your server\n                    // Submit Luxpag pay Interface and token = payload.nonce\n                    pay(payload.nonce);\n                });\n            },\n            onCancel: function (data) {\n            },\n            onError: function (err) {\n            }\n        }).render(\'#paypal-button\');\n    }).then(function () {\n    }).catch(function (err) {\n    });\n}\nfunction pay(token){\n    var param = {};\n    param.token = token;\n\n    $.ajax({\n        type: "POST",\n        url: "https://dev-gateway.luxpag.com/trade/pay",\n        headers: {\'Authorization\': \'Basic ???????\'},\n        cache: false,\n        dataType: "json",\n        contentType: "application/json",\n        data: JSON.stringify(param),\n        success: function (d) {\n        }\n    });\n}\n<\/script>  \n')])])])])}),[],!1,null,null,null);a.default=r.exports}}]);